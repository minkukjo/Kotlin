# 상속 관계 매핑

객체지향 프로그래밍에서는 여러 클래스를 구현할 때 공통 기능이나 변수가 있다면 상위 클래스로 부터 상속받은 자식 클래스를 만든다.

데이터베이스에서 이러한 상속 관계를 매핑하기 위한 3가지 방법이 있다.

## RDB에서의 상속의 의미

RDB에서는 별도로 '상속'이라는 개념이 존재하지 않는다.

ORM에서의 상속 관계 매핑은 객체의 상속 구조와 데이터베이스의 슈퍼타입 서브타입 관계를 매핑하는 것을 의미한다.

슈퍼타입-서브타입 논리 모델을 실제 물리 모델인 테이블로 구현하는 방법에는 3가지가 존재한다.

1. 각각의 테이블로 변환
2. 통합 테이블로 변환
3. 서브타입 테이블로 변환

## 1. 각각의 테이블로 변환

<img width="565" alt="스크린샷 2020-02-15 오후 10 37 19" src="https://user-images.githubusercontent.com/43809168/74588889-c1a3f480-5043-11ea-8945-8240817516f8.png">

각각의 테이블로 변환하는 것을 JPA에서는 조인전략이라 부른다.

위의 테이블 형태와 같이 엔티티 각각을 모두 테이블로 만들고 자식 테이블이 부모 테이블의 기본키를 받아 (기본키 + 외래키)로 사용하는 전략이다.

이때 Food 테이블에 있는 음식이 Rice,Pasta,Snack 중 무엇인지 알기 위해 DTYPE과 같이 타입을 구분하는 컬럼이 추가로 필요하게 된다.

위의 조인방식은 다음과 같은 특징을 갖는다.

- 장점
  - 테이블의 정규화
  - 외래키 참조 무결성 제약조건 활용 가능
  - 저장공간을 효율적으로 사용 가능

- 단점
  - 조회시 조인이 많이 사용되기 때문에 성능 저하
  - 조회 쿼리 복잡
  - 데이터를 등록할 때 마다 부모 테이블과 자식 테이블에 모두 저장해야하기 때문에 Insert 쿼리가 두번씩 실행

## 2. 단일 테이블 전략

<img width="189" alt="스크린샷 2020-02-15 오후 11 25 48" src="https://user-images.githubusercontent.com/43809168/74589668-822cd680-504a-11ea-80ef-0f5e91a100fe.png">

단일 테이블 전략이란 말 그대로 테이블을 하나만 사용하는 방식이다.

DTYPE이라는 구분 컬럼을 통해 어떤 자식 데이터가 들어있는지 구분할 수 있다.

이 전략은 조인을 사용하지않기 때문에 빠르다.

단일 테이블의 특징은 아래와 같다.

- 장점
  - 조회 쿼리 단순
  - 조인이 필요하지 않기때문에 속도가 빠름

- 단점
  - 자식 엔티티가 매핑한 컬럼은 모두 null을 허용해야 함
  - 단일 테이블에 모든 데이터를 저장하기 때문에 테이블이 커짐

## 3. 구현 클래스마다 테이블 전략

<img width="580" alt="스크린샷 2020-02-15 오후 11 28 35" src="https://user-images.githubusercontent.com/43809168/74589708-e5b70400-504a-11ea-92a5-9a42e4ec844e.png">

이름 그대로 구현 클래스마다 각각의 단일 테이블을 만드는 전략이다.

특징은 아래와 같다.

- 장점
  - not null 제약 조건 사용 가능
  - 서브 타입을 구분할 때 효과적

- 단점
  - 자식 테이블을 함께 조회해야할 때 성능이 느림
  - 자식 테이블을 통합해 쿼리를 하기 어려움

## Reference

https://hyeooona825.tistory.com/90