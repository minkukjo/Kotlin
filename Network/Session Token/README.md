# 웹 환경에서 인증의 필요성

웹 환경에서는 일반적으로 HTTP 프로토콜을 사용한다.

HTTP 프로토콜은 Stateless한 성질을 갖는다.

그 말은 내가 로그인을 하고 다음 창으로 넘어갔더니 로그아웃이 되서 매번 창을 넘어갈때 마다 로그인을 해줘야한다는 뜻이다.

때문에 웹사이트에서는 이 유저가 신뢰할 수 있는지를 판단할 수 있는 인증이 필요하며 사용자의 인증을 유지시켜줄 필요가 있게 되었다.

때문에 웹사이트는 일반적으로 유저의 접속 정보를 관리하기 위한 몇가지 방안이 있다.

## Session

세션 기반 인증을 위해서는 Session과 Cookie가 필요하다.

세션은 다음과 같은 과정으로 인증 절차가 진행된다

1. 유저가 로그인을 하게 되면 세션이 서버 메모리에 저장된다. 이때 세션을 식별하기 위해 **Session Id**를 기준으로 정보를 저장한다.

2. 서버는 클라이언트에게 **Session Id**를 건네준다. 브라우저는 쿠키에 **Session Id**를 저장한다.

3. 브라우저가 요청을 보낼 때 마다 **Session Id**를 담아서 서버에 요청을 보낸다.

4. 서버는 클라이언트로 부터 받은 **Session Id**와 서버 메모리에 있는 **Session Id**를 비교해서 인증을 수행한다.

일반적으로 세션은 세션 저장소를 필요로한다. 대표적으로 Redis가 있다.

### 세션 인증 방식의 장점

서버가 메모리에 Session Id를 적재하고 클라이언트에  Session Id를 넘겨주면 클라이언트는 쿠키에 세션 Id를 저장한다. 
그 후 서버에 요청을 보낼 때 쿠키(Session Id +)를 서버에 보내게 되는데 이렇게 되면 중간에 쿠키를 탈취당하더라도 쿠키 자체는 의미없는 값이기 때문에 계정 정보를 그대로 전달하는 것 보다 안전하다.

### 세션 인증 방식의 단점

장점에서 쿠키를 탈취당해도 괜찮다고 했지만 만약 제 3자가 탈취한 쿠키로 HTTP 요청을 보낸다면 서버 입장에서는 쿠키만 보고 인증을 진행하기 때문에 문제가 될 수 있다.

이를 해결하기 위해서 두가지 방법이 있는데 하나는 **HTTPS** 프로토콜을 사용해서 패킷을 중간에 가로채지 못하게 하는 방법이 있고, 다른 하나는 세션에 유효시간을 넣어주는 방법이 있다.

또 다른 단점은 **세션 저장소**를 추가로 사용한다는 점이다.

서버에 추가적인 공간을 필요로 하기 때문에 자연스럽게 부하 또한 높아지게 된다.

## Token (JWT)

Token, JWT는 세션/쿠키와 마찬가지로 웹의 인증 방식 중 하나이다.

Json Web Token의 약자로 인증에 필요한 정보들을 암호화시킨 토큰을 의미한다.

위의 방식과 유사하게 클라이언트는 HTTP Headder에 JWT 토큰을 실어서 보내게 된다.

토큰 인증 방식은 다음과 같은 방식으로 처리된다.

1. 유저가 로그인을 하고 서버는 세션을 이용해서 정보를 기록하는 대신 Token을 발급한다.

2. 클라이언트는 발급된 Token을 저장한다. (일반적으로 Local Storage에 저장한다.)

3. 클라이언트는 요청시 저장된 Token을 헤더에 포함해 전달한다.

4. 서버는 매 요청시 클라이언트로 전달받은 Token의 정보를 인증한 후 해당 유저에게 권한을 부여한다.

### Token 인증 방식의 장점

토큰 기반 인증의 장점은 세션과는 다르게 토큰이 클라이언트 측에 저장되기 때문에 서버의 메모리에 부담이 적다.

때문에 유저가 늘어나게 되더라도 서버의 Scale을 고려하지 않아도 된다.

### Token 인증 방식의 단점

1. 이미 발급된 토큰은 계속 사용이 가능하다.

해결책 : Access Token의 유효기간을 짧게 설정한다.

2. 세션/쿠키에 비해 JWT는 길이가 길다. 따라서 인증이 필요한 요청이 많아질 수록 서버가 처리해야하는 자원 낭비가 커지게 된다.

## 결론

Session/Cookie 방식과 Token 방식 중 어느 방법이 더 뛰어나가도 할 수는 없다.

두 방식 모두 현재까지 사용하고 있기 때문에 어떠한 인증방식을 사용하는 것이 적합한지 판단하여 사용하는 것이 필요하겠다.

## Reference

https://jins-dev.tistory.com/

https://tansfil.tistory.com/58

